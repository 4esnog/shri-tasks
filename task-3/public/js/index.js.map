{"version":3,"sources":["js/index.js"],"names":["onMagicButtonClick","e","preventDefault","togglePreloader","createVideo","videoInput","value","then","videoEl","canvas","width","videoWidth","height","videoHeight","backCanvas","ctx","fillStyle","canvasBgColor","fillRect","player","appendChild","ui","block","video","document","querySelector","remove","createAudio","audioInput","audioEl","audio","fetch","subtitlesInput","text","subtitles","parseSrt","onPlayPause","paused","ended","state","play","classList","pause","add","onInputChange","type","reader","FileReader","readAsText","target","files","mediaLoad","onloadend","result","readAsDataURL","src","Promise","resolve","reject","createElement","setAttribute","autoplay","volume","addEventListener","audioCtx","window","AudioContext","webkitAudioContext","source","createMediaElementSource","leftPan","createStereoPanner","rightPan","pan","connect","destination","controls","defaultMuted","style","visibility","onVideoPlay","videoSizeRatio","clientWidth","clientHeight","parseInt","getComputedStyle","toFixed","display","videoTimelineRatio","duration","subtitleStyles","padding","paddingRatio","fontSize","fontRatio","lineInterval","lineIntervalRatio","time","currentTime","subtitleIndex","endTime","subtitleShown","subtitleTimer","setTimeout","hideSubtitle","timeLength","createUI","stop","timeline","onVolumeChange","onVolumeChangeEnd","drawVideo","removeEventListener","_this","this","stopped","getContext","bctx","clearRect","drawImage","imgData","getImageData","data","brightnessRatio","getRandomInt","brightnessDiffRatio","i","length","grainRatio","grainDiffRatio","r","g","b","avg","putImageData","showSubtitle","Math","random","scratchStyle","frequency","requestAnimationFrame","drawScratches","newFps","minFps","maxFps","bind","amount","floor","scratch","generateSingleScratch","strokeStyle","lineWidth","beginPath","moveTo","coords","from","x","y","lineTo","to","stroke","closePath","opacity","minOpacity","maxOpacity","gray","modifiers","color","a","flagX","round","flagY","minLength","maxLength","maxX","maxY","sqrt","pow","startCoords","endCoords","subtl","cl","canvasTextColor","font","fullTextHeight","content","topPadding","forEach","el","top","left","fillText","timeConst","sec","min","hr","temp","split","map","res","subtitle","number","startTime","startTimeSec","join","startTimeMin","startTimeHr","endTimeSec","endTimeMin","endTimeHr","splice","onWindowResize","preloader","querySelectorAll","toggle","url","method","xhr","XMLHttpRequest","open","responseType","onreadystatechange","readyState","status","responseText","send","max","urls","videoLocal","audioLocal","srt","srtLocal","magicButton","getElementById","bodyStyle","bodyPadding","paddingLeft","paddingRight","hex","undefined"],"mappings":"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","file":"index.js","sourcesContent":["'use strict';\n\n// import srt from 'srt.js';\n\nconst urls = {\n\tvideo: 'https://cache-default04g.cdn.yandex.net/kp.cdn.yandex.net/502838/kinopoisk.ru-Sherlock-284167.mp4',\n\tvideoLocal: '../assets/kinopoisk.ru-Sherlock-284167.mp4',\n\n\taudio: 'https://upload.wikimedia.org/wikipedia/commons/2/2c/The_Entertainer_-_1902_-_By_Scott_Joplin.ogg',\n\taudioLocal: '../assets/The_Entertainer_-_1902_-_By_Scott_Joplin.ogg',\n\n\tsrt: 'https://raw.githubusercontent.com/shri-msk-2016/dz-multimedia/master/subs.srt',\n\tsrtLocal: '../assets/subs.srt'\n};\n\n// Get existing DOM nodes\nconst magicButton = document.getElementById('magic-button');\nconst videoInput = document.getElementById('video');\nconst audioInput = document.getElementById('audio');\nconst subtitlesInput = document.getElementById('subtitles');\nconst player = document.getElementById('player');\n\n// Init player UI\nconst ui = createUI();\n\n// Init canvas w/ styles\nconst backCanvas = document.createElement('canvas');\nconst canvas = document.createElement('canvas');\nbackCanvas.setAttribute('crossorigin', 'anonymus');\ncanvas.setAttribute('crossorigin', 'anonymus');\nconst\tctx = canvas.getContext('2d');\n\n\nlet bodyStyle = getComputedStyle(document.querySelectorAll('body')[0]);\nlet bodyPadding = parseInt(bodyStyle.paddingLeft) + parseInt(bodyStyle.paddingRight);\n\n// === НАСТРОЙКИ ===\n// Цвет фона субтитров\nconst canvasBgColor = {\n\tr: 16,\n\tg: 20,\n\tb: 16,\n\thex: \"#101410\"\n};\nconst canvasTextColor = '#e1e8e2'; // Цвет текста субтитров\nconst brightnessDiffRatio = 0.2; // Коэффициент разброса яркости кадров\nconst grainDiffRatio = 0.15; // Коэффициент зернистости (шума)\nconst minFps = 18;\nconst maxFps = 26;\nconst scratchStyle = {\n\tminLength: 5,    // Длина и прозрачность царапин,\n\tmaxLength: 20,   // в % от высоты видео (от 0 до 100)\n\tminOpacity: 30,  // 0 .. 100\n\tmaxOpacity: 90,  // 0 .. 100\n\tfrequency: 0.75, // 0 .. 1\n}\n// const downsampleRatio = 5;\nconst subtitleStyles = {\n\tfontRatio: 0.055,\n\tpaddingRatio: 0.1,\n\tlineIntervalRatio: 0.5\n};\n// === END НАСТРОЙКИ ===\n\n\nlet state = {\n\tsubtitleShown: false,\n\tsubtitleIndex: 0,\n\tmediaLoad: 0,\n\tpaused: true\n};\n\nlet\tvideoWidth,\n\t\tvideoHeight,\n\t\tvideoSizeRatio,\n\t\tvideoTimelineRatio,\n\t\tvideo,\n\t\taudio,\n\t\tsubtitles;\n\n\n// === Set initial event handlers ===\nmagicButton.addEventListener('click', onMagicButtonClick);\nvideoInput.addEventListener('change', onInputChange.bind(this, 'video'));\naudioInput.addEventListener('change', onInputChange.bind(this, 'audio'));\nsubtitlesInput.addEventListener('change', onInputChange.bind(this, 'subtitles'));\ncanvas.addEventListener('click', onPlayPause);\nwindow.addEventListener('resize', onWindowResize);\n\n\n// === Helpers ===\n\n// === Handle \"Maigc\" button click ===\nfunction onMagicButtonClick(e) {\n\t\n\te.preventDefault();\n\ttogglePreloader(true);\n\t\n\tcreateVideo('http://cors.io/?u=' + videoInput.value)\n\t\t.then((videoEl) => {\n\t\t\t\n\t\t\tcanvas.width = videoWidth;\n\t\t\tcanvas.height = videoHeight;\n\n\t\t\tbackCanvas.width = videoWidth;\n\t\t\tbackCanvas.height = videoHeight;\n\t\t\tctx.fillStyle = canvasBgColor;\n\t\t\tctx.fillRect(0, 0, canvas.width, canvas.height);\n\t\t\tplayer.appendChild(ui.block);\n\t\t\tplayer.appendChild(canvas);\n\n\t\t\tvideo = videoEl;\n\t\t\tdocument.querySelector('#popup').remove();\n\t\t\ttogglePreloader(false);\n\t\t}\n\t);\n\t\n\tcreateAudio('http://cors.io/?u=' + audioInput.value)\n\t\t.then((audioEl) => {\n\t\t\taudio = audioEl;\n\t\t}\n\t);\n\n\tfetch(subtitlesInput.value, 'GET')\n\t\t.then((text) => {\n\t\t\tsubtitles = parseSrt(text);\n\t\t});\n\n}\n\nfunction onPlayPause(e) {\n\tif (video.paused || video.ended) {\n\t\tstate.paused = false;\n\t\tvideo.play();\n\t\taudio.play();\n\t\tui.play.classList.remove('paused');\n\t} else {\n\t\tstate.paused = true;\n\t\tvideo.pause();\n\t\taudio.pause();\n\t\tui.play.classList.add('paused');\n\t}\n}\n\n\n// === Process input ===\nfunction onInputChange(type, e) {\n\t\n\tlet reader = new FileReader();\n\n\tif (type === 'subtitles') {\n\t\treader.readAsText(e.target.files[0]);\n\t\tstate.mediaLoad++;\n\t\treader.onloadend = (e) => {\t\t\n\t\t\tsubtitles = parseSrt(reader.result);\n\t\t\tstate.mediaLoad++;\n\t\t}\n\n\t} else if (type === 'audio') {\n\t\treader.readAsDataURL(e.target.files[0]);\n\t\tstate.mediaLoad++;\n\t\treader.onloadend = (e) => {\t\t\n\t\t\taudio = createAudio(reader.result);\n\t\t\tstate.mediaLoad++;\n\t\t}\n\n\t} else if (type === 'video') {\n\t\treader.readAsDataURL(e.target.files[0]);\n\t\tstate.mediaLoad++;\n\t\treader.onloadend = (e) => {\t\t\n\t\t\tvideo = createVideo(reader.result);\n\t\t\tstate.mediaLoad++;\n\t\t}\n\n\t}\n\n}\n\n// === Process audio from input ===\nfunction createAudio(src) {\n\treturn new Promise((resolve, reject) => {\n\t\ttry {\n\t\t\tlet audio = document.createElement('audio');\n\t\t\taudio.setAttribute('crossorigin', 'anonymus');\n\t\t\t// audio.setAttribute('preload', 'true');\n\t\t\taudio.src = src;\n\t\t\taudio.autoplay = false;\n\t\t\taudio.volume = 0.5;\n\t\t\taudio.addEventListener('loadeddata', (e) => {\n\t\t\t\tresolve(audio);\n\n\t\t\t\tlet audioCtx = new (window.AudioContext || window.webkitAudioContext)();\n\t\t\t\tlet source = audioCtx.createMediaElementSource(audio);\n\t\t\t\tlet leftPan = audioCtx.createStereoPanner();\n\t\t\t\tlet rightPan = audioCtx.createStereoPanner();\n\t\t\t\t// let gainNode = audioCtx.createGain();\n\t\t\t\tleftPan.pan.value = -1;\n\t\t\t\t// rightPan.pan.value = 1;\n\n\t\t\t\tsource.connect(rightPan);\n\t\t\t\tsource.connect(leftPan);\n\t\t\t\t// leftPan.connect(gainNode);\n\t\t\t\tleftPan.connect(audioCtx.destination);\n\t\t\t\t// rightPan.connect(audioCtx.destination);\n\n\t\t\t\t// source.connect(audioCtx.destination);\n\t\t\t});\n\t\t} catch(e) {\n\t\t\treject(e);\n\t\t}\n\t\t\n\t});\n\t\n\n\taudio.addEventListener('canplay', (e) => {\n\n\t});\n\n}\n\n// === Process video from input ===\nfunction createVideo(src) {\n\treturn new Promise((resolve, reject) => {\n\t\tlet video = document.createElement('video');\n\t\tvideo.setAttribute('crossorigin', 'anonymus');\n\t\tvideo.setAttribute('preload', 'true');\n\t\tvideo.src = src;\n\t\tvideo.autoplay = false;\n\t\tvideo.controls = false;\n\t\tvideo.defaultMuted = true;\n\t\tvideo.style.visibility = 'hidden';\n\n\t\tvideo.addEventListener('play', onVideoPlay, false);\n\t\t\n\t\tvideo.addEventListener('loadeddata', (e) => {\n\t\t\tdocument.querySelector('body').appendChild(video);\n\n\t\t\tvideoSizeRatio = video.clientWidth / video.clientHeight;\n\t\t\tvideoWidth = parseInt(getComputedStyle(player).width).toFixed();\n\t\t\tvideoHeight = videoWidth / videoSizeRatio;\n\t\t\t\n\t\t\tvideo.style.display = 'none';\n\t\t\tvideoTimelineRatio = video.duration / 100;\n\n\t\t\tsubtitleStyles.padding = videoWidth * subtitleStyles.paddingRatio;\n\t\t\tsubtitleStyles.fontSize = videoHeight * subtitleStyles.fontRatio;\n\t\t\tsubtitleStyles.lineInterval = subtitleStyles.fontSize * subtitleStyles.lineIntervalRatio;\n\t\t\tresolve(video);\n\t\t\t\n\t\t});\n\n\t\tvideo.addEventListener('timeupdate', (e) => {\n\t\t\tlet time = (e.target.currentTime * 1000).toFixed();\n\t\t\tif (time >= subtitles[state.subtitleIndex].endTime) {\n\t\t\t\tstate.subtitleShown = true;\n\t\t\t\tvideo.pause();\n\t\t\t\tstate.subtitleTimer = setTimeout(hideSubtitle, subtitles[state.subtitleIndex].timeLength);\n\t\t\t}\n\t\t\t\n\t\t});\n\t});\n\t\n\n\t// return video;\n}\n\n// === Init UI for canvas player\nfunction createUI() {\n\tlet ui = {\n\t\tblock: document.createElement('div'),\n\t\tplay: document.createElement('div'),\n\t\tstop: document.createElement('div'),\n\t\ttimeline: document.createElement('input'),\n\t\tvolume: document.createElement('input')\n\t};\n\tui.block.classList.add('player-ui');\n\tui.block.appendChild(ui.play);\n\tui.block.appendChild(ui.stop);\n\tui.block.appendChild(ui.timeline);\n\tui.block.appendChild(ui.volume);\n\n\tui.play.classList.add('player-ui__el', 'player-ui__el_play-pause', 'paused');\n\tui.stop.classList.add('player-ui__el', 'player-ui__el_stop');\n\tui.timeline.setAttribute('type', 'range');\n\tui.timeline.classList.add('player-ui__el', 'player-ui__el_timeline');\n\tui.timeline.value = 0;\n\tui.volume.setAttribute('type', 'range');\n\tui.volume.setAttribute('touch-action', 'none');\n\tui.volume.classList.add('player-ui__el', 'player-ui__el_volume');\n\n\tui.play.addEventListener('click', onPlayPause);\n\n\tui.stop.addEventListener('click', (e) => {\n\t\tvideo.pause();\n\t\taudio.pause();\n\t\tvideo.currentTime = 0;\n\t\taudio.currentTime = 0;\n\t\tstate.subtitleIndex = 0;\n\t\tui.play.classList.add('paused');\n\t\tui.timeline.value = 0;\n\t});\n\n\tui.timeline.addEventListener('change', (e) => {\n\t\tvideo.currentTime = parseInt(e.target.value) * videoTimelineRatio;\n\t\taudio.currentTime = video.currentTime;\n\t});\n\n\tui.volume.addEventListener('pointerdown', (e) => {\n\t\te.target.addEventListener('pointermove', onVolumeChange);\n\t\te.target.addEventListener('pointerup', onVolumeChangeEnd);\n\t});\n\n\tui.volume.addEventListener('click', (e) => {\n\t\taudio.volume = e.target.value / 100;\n\t\tif (audio.volume === 0) {\n\t\t\te.target.classList.add('muted');\n\t\t} else {\n\t\t\te.target.classList.remove('muted');\n\t\t}\n\t});\n\n\treturn ui;\n}\n\n// === Process video.play() ===\nfunction onVideoPlay(e) {\n\tdrawVideo(video, canvas, backCanvas, videoWidth, videoHeight);\n\taudio.play();\n}\n\nfunction onVolumeChange(e) {\n\taudio.volume = parseInt(e.target.value) / 100;\n\tif (audio.volume === 0) {\n\t\te.target.classList.add('muted');\n\t} else {\n\t\te.target.classList.remove('muted');\n\t}\n}\n\nfunction onVolumeChangeEnd(e) {\n\te.target.removeEventListener('pointermove', onVolumeChange);\n\te.target.removeEventListener('pointerup', onVolumeChangeEnd);\n}\n\n// === Draw video on canvas with Effects ===\nfunction drawVideo(video, canvas, backCanvas, width, height) {\n\t\n\tif (state.paused || video.ended || state.stopped) {\n\t\taudio.pause();\n\t\treturn false;\n\t}\n\n\tconst ctx = canvas.getContext('2d');\n\tconst bctx = backCanvas.getContext('2d');\n\tconst gl = canvas.getContext('webgl');\n\n\t// requestAnimationFrame(() => {\n\n\t\tif (!video.paused && !state.subtitleShown) {\n\t\t\tbctx.clearRect(0, 0, width, height);\n\t\t\tctx.clearRect(0, 0, width, height);\n\t\t\t\n\t\t\tbctx.drawImage(video, 0, 0, width, height);\n\t\t\tlet imgData = bctx.getImageData(0, 0, width, height);\n\t\t\tlet data = imgData.data;\n\t\t\tlet brightnessRatio = getRandomInt(\n\t\t\t\t100 - 100*brightnessDiffRatio,\n\t\t\t\t100 + 100*brightnessDiffRatio) / 100;\n\n\t\t\tfor (let i = 0; i < data.length; i+=4) {\n\t\t\t\tlet grainRatio = getRandomInt(\n\t\t\t\t\t100 - 100*grainDiffRatio,\n\t\t\t\t\t100 + 100*grainDiffRatio) / 100;\n\n\t\t\t\tlet r = data[i];\n\t\t\t\tlet g = data[i+1];\n\t\t\t\tlet b = data[i+2];\n\n\t\t\t\tlet avg = ((0.21 * r) + (0.72 * g) + (0.07 * b)) * brightnessRatio * grainRatio;\n\n\t\t\t\tdata[i] = avg + 15 * grainRatio;\n\t\t\t\tdata[i+1] = avg + 10 * grainRatio;\n\t\t\t\tdata[i+2] = avg;\n\t\t\t}\n\n\t\t\tctx.putImageData(imgData, 0, 0);\n\t\t}\n\t\t\n\t\tif (state.subtitleShown) {\n\t\t\tshowSubtitle(subtitles[state.subtitleIndex]);\n\t\t}\n\n\t// });\n\n\tif (Math.random() < scratchStyle.frequency) {\n\t\trequestAnimationFrame(() => {\n\t\t\tdrawScratches(canvas);\n\t\t});\t\n\t}\n\t\n\tlet newFps = 1000 / getRandomInt(minFps, maxFps); // 1000 - ms in s\n\n\tsetTimeout(() => {\n\t\trequestAnimationFrame(drawVideo.bind(this, video, canvas, backCanvas, videoWidth, videoHeight));\n\t}, newFps);\n}\n\n// === Рисование случайного числа случайных царапин ===\nfunction drawScratches(canvas) {\n\tconst ctx = canvas.getContext('2d');\n\tconst width = canvas.width;\n\tconst height = canvas.height;\n\n\tconst amount = Math.floor(getRandomInt(0, 100) - 90); // MAGIC 2\n\n\tfor (let i = 0; i <= amount; i++) {\n\t\tlet scratch = generateSingleScratch(canvas);\n\t\tctx.strokeStyle = scratch.style;\n\t\tctx.lineWidth = scratch.width;\n\n\t\tctx.beginPath();\n\t\tctx.moveTo(scratch.coords.from.x, scratch.coords.from.y);\n\t\tctx.lineTo(scratch.coords.to.x, scratch.coords.to.y);\n\t\tctx.stroke();\n\t\tctx.closePath();\n\t}\n}\n\n// === Генерация одной царапины (но не рисование) ===\nfunction generateSingleScratch(canvas) {\n\tconst ctx = canvas.getContext('2d');\n\tconst width = canvas.width;\n\tconst height = canvas.height;\n\n\t// === Генерация цвета царапины ===\n\tlet opacity = getRandomInt(scratchStyle.minOpacity, scratchStyle.maxOpacity) / 100; // MAGIC\n\tlet gray = getRandomInt(140, 180); // MAGIC\n\tlet modifiers = {\n\t\tr: getRandomInt(-20, 20),\n\t\tg: getRandomInt(-20, 20),\n\t\tb: getRandomInt(-20, 20)\n\t};\n\tlet color = {\n\t\tr: gray + modifiers.r,\n\t\tg: gray + modifiers.g,\n\t\tb: gray + modifiers.b,\n\t\ta: opacity\n\t};\n\n\tlet strokeStyle = `rgba(${color.r}, ${color.g}, ${color.b}, ${color.a})`;\n\n\t// === Генерация толщины царапины ===\n\tlet lineWidth = getRandomInt(1, 2);\n\t\n\t// === Генерация координат царапины ===\n\t// flag = -1 или 1\n\tlet flagX = 2 * Math.round(Math.random()) - 1;\n\tlet flagY = 2 * Math.round(Math.random()) - 1;\n\n\tlet length = getRandomInt(height * scratchStyle.minLength / 100,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\theight * scratchStyle.maxLength / 100);\n\tlet maxX = getRandomInt(0, length);\n\tlet maxY = Math.sqrt(Math.pow(length, 2) - Math.pow(maxX, 2));\n\n\tlet startCoords = {\n\t\tx: getRandomInt(0, width),\n\t\ty: getRandomInt(0, height),\n\t};\n\n\tlet endCoords = {\n\t\tx: startCoords.x + maxX*flagX,\n\t\ty: startCoords.y + maxY*flagY,\n\t};\n\n\tlet coords = {\n\t\tfrom: startCoords,\n\t\tto: endCoords\n\t};\n\n\treturn {\n\t\tstyle: strokeStyle,\n\t\twidth: lineWidth,\n\t\tcoords: coords\n\t};\n\n}\n\n// === Показать кадр с субтитрами ===\nfunction showSubtitle(subtl) {\n\n\tif (!state.subtitleShown) {\n\t\treturn false;\n\t}\n\n// rgb(16, 17, 16)\n\tlet brightnessRatio = getRandomInt(\n\t\t100 - 100*brightnessDiffRatio,\n\t\t100 + 100*brightnessDiffRatio) / 100;\n\tlet cl = {\n\t\tr: (canvasBgColor.r * brightnessRatio).toFixed(),\n\t\tg: (canvasBgColor.g * brightnessRatio).toFixed(),\n\t\tb: (canvasBgColor.b * brightnessRatio).toFixed()\n\t};\n\tctx.fillStyle = `rgb(${cl.r}, ${cl.g}, ${cl.b})`;\n\tctx.fillRect(0, 0, canvas.width, canvas.height);\n\tctx.fillStyle = canvasTextColor;\n\tctx.font = `${subtitleStyles.fontSize}px Oranienbaum bold, serif`;\n\n\tlet fullTextHeight = (subtl.content.length * subtitleStyles.fontSize)\n\t\t\t\t\t\t\t + ((subtl.content.length - 1) * subtitleStyles.lineInterval);\n\tlet topPadding = (videoHeight - fullTextHeight) / 2;\n\n\tsubtl.content.forEach((el, i) => {\n\t\tlet top = topPadding + (subtitleStyles.fontSize * i)\n\t\t\t\t\t\t\t+ (subtitleStyles.lineInterval * i);\n\t\tlet left = subtitleStyles.padding;\n\t\tctx.fillText(el, left, top);\n\t});\n\t\n}\n\nfunction hideSubtitle() {\n\tstate.subtitleShown = false;\n\tstate.subtitleIndex++;\n\tvideo.play();\n}\n\n// === Распарсить .SRT в Массив субтитров ===\nfunction parseSrt(text) {\n\tlet timeConst = {\n\t\tsec: 1000,\n\t\tmin: 60,\n\t\thr: 60\n\t};\n\tlet temp = text.split('\\n\\n');\n\n\tlet result = temp.map((el) => {\n\n\t\tlet res = {};\n\t\tlet subtitle = el.split('\\n');\n\n\t\t// === Get subtitle's number ===\n\t\tres.number = parseInt(subtitle[0]);\n\n\t\tlet time = subtitle[1].split(' --> ');\n\n\t\t// === Convert start time to MS ===\n\t\tlet startTime = time[0].split(':');\n\t\tlet startTimeSec = parseInt(startTime[2].split(',').join(''));\n\t\tlet startTimeMin = parseInt(startTime[1]) * timeConst.min * timeConst.sec;\n\t\tlet startTimeHr = parseInt(startTime[0]) * timeConst.hr * timeConst.min * timeConst.sec;\n\t\tstartTime = startTimeSec + startTimeMin\t+ startTimeHr;\n\t\tres.startTime = startTime;\n\n\t\t// === Convert end time to MS ===\n\t\tlet endTime = time[1].split(':');\n\t\tlet endTimeSec = parseInt(endTime[2].split(',').join(''));\n\t\tlet endTimeMin = parseInt(endTime[1]) * timeConst.min * timeConst.sec;\n\t\tlet endTimeHr = parseInt(endTime[0]) * timeConst.hr * timeConst.min * timeConst.sec;\n\t\tendTime = endTimeSec + endTimeMin\t+ endTimeHr;\n\t\tres.endTime = endTime;\n\n\t\tres.timeLength = endTime - startTime;\n\n\t\t// === Join subtitle content ===\n\t\tsubtitle.splice(0, 2);\n\t\tres.content = subtitle;\n\n\t\treturn res;\n\t});\n\n\treturn result;\n\n}\n\n// === Перенастройка всего при resize страницы ===\nfunction onWindowResize(e) {\n\t\n\tvideoWidth = parseInt(getComputedStyle(player).width).toFixed();\n\tvideoHeight = videoWidth / videoSizeRatio;\n\n\tcanvas.width = videoWidth;\n\tcanvas.height = videoHeight;\n\tbackCanvas.width = videoWidth;\n\tbackCanvas.height = videoHeight;\n\n\tsubtitleStyles.padding = videoWidth * subtitleStyles.paddingRatio;\n\tsubtitleStyles.fontSize = videoHeight * subtitleStyles.fontRatio;\n\tsubtitleStyles.lineInterval = subtitleStyles.fontSize * subtitleStyles.lineIntervalRatio;\n\n}\n\n// === Показать / скрыть прелоадер ===\nfunction togglePreloader(state) {\n\n\tlet preloader = document.querySelectorAll('.preloader')[0];\n\tif (state === true) {\n\t\tpreloader.classList.add('shown');\n\t} else if (state === false) {\n\t\tpreloader.classList.remove('shown');\n\t} else {\n\t\tpreloader.classList.toggle('shown');\n\t}\n\n}\n\n// === Обёртка для XHR с использованием Promise ===\nfunction fetch(url, method) {\n\tmethod = method || 'GET';\n\n\treturn new Promise((resolve, reject) => {\n\t\t\n\t\tlet xhr = new XMLHttpRequest();\n\t\txhr.open(method, url, true);\n\t\txhr.responseType = 'text';\n\n\t\txhr.onreadystatechange = (e) => {\n\n\t\t\tif (xhr.readyState === 4) {\n\t\t\t\tif (xhr.status !== 200) {\n\t\t\t\t\treject(xhr.responseText);\n\t\t\t\t} else {\n\t\t\t\t\tresolve(xhr.responseText);\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\t\txhr.send();\n\n\t});\n}\n\n// === Получить случайное число от min до max ===\nfunction getRandomInt(min, max) {\n  return Math.floor(Math.random() * (max - min)) + min;\n}\n\n\n\n\n\n// function prepareWebGL(canvas, gl, sourceCanvas) {\n//     var program = gl.createProgram();\n\n//     var vertexCode = 'attribute vec2 coordinates;' +\n//         'attribute vec2 texture_coordinates;' +\n//         'varying vec2 v_texcoord;' +\n//         'void main() {' +\n//         '  gl_Position = vec4(coordinates,0.0, 1.0);' +\n//         '  v_texcoord = texture_coordinates;' +\n//         '}';\n\n//     var vertexShader = gl.createShader(gl.VERTEX_SHADER);\n//     gl.shaderSource(vertexShader, vertexCode);\n//     gl.compileShader(vertexShader);\n\n//     var fragmentCode = 'precision mediump float;' +\n//         'varying vec2 v_texcoord;' +\n//         'uniform sampler2D u_texture;' +\n//         'uniform float u_time;' +\n//         'float rand(vec2 co){' +\n//         '   return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);' +\n//         '}' +\n//         'void main() {' +\n//         '   gl_FragColor = texture2D(u_texture, v_texcoord) * .8 + texture2D(u_texture, v_texcoord) * rand(v_texcoord * u_time) * .2;' +\n//         '}';\n\n//     var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n//     gl.shaderSource(fragmentShader, fragmentCode);\n//     gl.compileShader(fragmentShader);\n\n//     gl.attachShader(program, vertexShader);\n//     gl.attachShader(program, fragmentShader);\n\n//     gl.linkProgram(program);\n//     gl.useProgram(program);\n\n//     var positionLocation = gl.getAttribLocation(program, 'coordinates');\n//     var texcoordLocation = gl.getAttribLocation(program, 'texture_coordinates');\n//     GL_TIME_UNIFORM = gl.getUniformLocation(program, 'u_time');\n\n//     var buffer = gl.createBuffer();\n//     var vertices = [\n//         -1, -1,\n//         1, -1,\n//         -1, 1,\n//         -1, 1,\n//         1, -1,\n//         1, 1\n//     ];\n//     gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n//     gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);\n//     gl.enableVertexAttribArray(positionLocation);\n//     gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);\n\n//     buffer = gl.createBuffer();\n//     var textureCoordinates = [\n//         0, 1,\n//         1, 1,\n//         0, 0,\n//         0, 0,\n//         1, 1,\n//         1, 0\n//     ];\n//     gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n//     gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(textureCoordinates), gl.STATIC_DRAW);\n//     gl.enableVertexAttribArray(texcoordLocation);\n//     gl.vertexAttribPointer(texcoordLocation, 2, gl.FLOAT, false, 0, 0);\n// }\n\n\n// function postprocessWebGL(canvas, gl, sourceCanvas, delta) {\n//     GL_TIME += delta;\n//     gl.uniform1f(GL_TIME_UNIFORM, GL_TIME / 1000);\n//     var texture = gl.createTexture();\n//     gl.bindTexture(gl.TEXTURE_2D, texture);\n//     gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n//     gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n//     gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n//     gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n//     gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, sourceCanvas);\n\n//     gl.viewport(0,0,canvas.width,canvas.height);\n//     gl.enable(gl.DEPTH_TEST);\n//     gl.clear(gl.COLOR_BUFFER_BIT);\n//     gl.drawArrays(gl.TRIANGLES, 0, 6);\n// }"],"sourceRoot":"/source/"}